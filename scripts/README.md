# Survey Assist: Local Run Processing Pipeline

This is a modular pipeline for processing and evaluating local JSON output files generated by the Survey Assist model. 
The pipeline merges model predictions with cleaned ground truth data, adds quality flags, and prepares
the data for downstream analysis.

## Overview

The pipeline consists of three main components:

1. **JsonProcessor**  
   Located in: `survey_assist_utils/processing/json_processor.py`  
   This class is responsible for reading and flattening raw JSON output files from the model.
   It extracts key fields such as:
   - `unique_id`
   - `classified`
   - `chosen_sic_code`
   - Top N candidate SIC codes and their likelihoods

   The result is a structured `pandas.DataFrame` that can be merged with ground truth data.

2. **FlagGenerator**  
   Located in: `survey_assist_utils/processing/flag_generator.py`  
   This class enriches the ground truth DataFrame with data quality and codability flags, including:
   - `num_answers`: Number of valid SIC labels provided
   - `Match_5_digits`, `Match_3_digits`, `Match_2_digits`: Format validation flags
   - `Unambiguous`: Indicates whether a record has a single, well-formed SIC label

   These flags support filtering and evaluation of human-coded data.

3. **Runner Script**  
   Located in: `scripts/process_local_run.py`  
   This script orchestrates the full processing pipeline:
   - Loads cleaned ground truth data from a CSV file
   - Applies `FlagGenerator` to add quality flags
   - Uses `JsonProcessor` to flatten the model's JSON output
   - Merges the two datasets on `unique_id`
   - Computes evaluation metrics using `MetricCalculator`
   - Saves the final processed DataFrame to a CSV file

## Example Usage

```bash
python scripts/process_local_run.py data/json_runs/20250620_153641_output.json \
  --raw_data data/cleaned_data/cleaned_DSC_Rep_Sample.csv \
  --output data/final_processed_output.csv
# Survey Assist: Local Run Processing Pipeline

This is a modular pipeline for processing and evaluating local JSON output files generated by
the Survey Assist model.
The pipeline merges model predictions with cleaned ground truth data, adds quality flags,
and prepares the data for downstream analysis.

## Overview

The pipeline consists of three main components:

1. **JsonProcessor**  
   Located in: `survey_assist_utils/processing/json_processor.py`  
   This class is responsible for reading and flattening raw JSON output files from the model.
   It extracts key fields such as:
   - `unique_id`
   - `classified`
   - `chosen_sic_code`
   - Top N candidate SIC codes and their likelihoods

   The result is a structured `pandas.DataFrame` that can be merged with ground truth data.

2. **FlagGenerator**  
   Located in: `survey_assist_utils/processing/flag_generator.py`  
   This class enriches the ground truth DataFrame with data quality and codability flags, including:
   - `num_answers`: Number of valid SIC labels provided
   - `Match_5_digits`, `Match_3_digits`, `Match_2_digits`: Format validation flags
   - `Unambiguous`: Indicates whether a record has a single, well-formed SIC label

   These flags support filtering and evaluation of human-coded data.

3. **Runner Script**  
   Located in: `scripts/process_local_run.py`  
   This script orchestrates the full processing pipeline:
   - Loads cleaned ground truth data from a CSV file
   - Applies `FlagGenerator` to add quality flags
   - Uses `JsonProcessor` to flatten the model's JSON output
   - Merges the two datasets on `unique_id`
   - Saves the final processed DataFrame to a CSV file

## Example Usage

```bash
python scripts/process_local_run.py data/json_runs/20250620_153641_output.json \
  --raw_data data/cleaned_data/cleaned_DSC_Rep_Sample.csv \
  --output data/final_processed_output.csv
```